(function(i,b,g){var c=function(h,e){var j=b.createElementNS("http://www.w3.org/2000/svg",h);i.each(e,function(n,m){j.setAttribute(n,m)});return j},k="createElementNS" in b&&c("svg",{}).createSVGRect,a=1/(window.devicePixelRatio||1),f=i.fn.peity=function(h,e){k&&this.each(function(){var p=i(this),o=p.data("peity");if(o){h&&(o.type=h),i.extend(o.opts,e)}else{var n=f.defaults[h],m={};i.each(p.data(),function(r,q){r in n&&(m[r]=q)});var j=i.extend({},n,m,e),o=new l(p,h,j);p.change(function(){o.draw()}).data("peity",o)}o.draw()});return this},l=function(h,e,j){this.$el=h;this.type=e;this.opts=j},d=l.prototype;d.draw=function(){f.graphers[this.type].call(this,this.opts)};d.fill=function(){var h=this.opts.fill,e=h;i.isFunction(e)||(e=function(j,m){return h[m%h.length]});return e};d.prepare=function(h,e){var j;this.svg?j=i(this.svg).empty():(this.svg=c("svg",{"class":"peity"}),this.$el.hide().after(this.svg),j=i(this.svg).data("peity",this));this.svg.setAttribute("height",e);this.svg.setAttribute("width",h);return j};d.values=function(){return i.map(this.$el.text().split(this.opts.delimiter),function(e){return parseFloat(e)})};f.defaults={};f.graphers={};f.register=function(h,e,j){this.defaults[h]=e;this.graphers[h]=j};f.register("pie",{delimiter:null,diameter:16,fill:["#ff9900","#fff4dd","#ffc66e"]},function(F){if(!F.delimiter){var E=this.$el.text().match(/[^0-9\.]/);F.delimiter=E?E[0]:","}E=this.values();if("/"==F.delimiter){var D=E[0],E=[D,g.max(0,E[1]-D)]}for(var C=0,D=E.length,A=0;C<D;C++){A+=E[C]}for(var F=this.prepare(F.width||F.diameter,F.height||F.diameter),C=F.width(),z=F.height(),F=C/2,z=z/2,s=g.min(F,z),B=g.PI,x=this.fill(),y=-B/2,C=0;C<D;C++){var t=E[C],v=t/A,w;if(0!=v){if(1==v){w=c("circle",{cx:F,cy:z,r:s})}else{w=2*v*B;var v=y+w,u=s*g.cos(y)+F,y=s*g.sin(y)+z,o=s*g.cos(v)+F,h=s*g.sin(v)+z;w=c("path",{d:["M",F,z,"L",u,y,"A",s,s,0,w>B?1:0,1,o,h,"Z"].join(" ")});y=v}w.setAttribute("fill",x.call(this,t,C,E));this.svg.appendChild(w)}}});f.register("line",{delimiter:",",fill:"#c6d9fd",height:16,max:null,min:0,stroke:"#4d89f9",strokeWidth:1,width:32},function(v){var u=this.values();1==u.length&&u.push(u[0]);for(var t=g.max.apply(g,u.concat([v.max])),s=g.min.apply(g,u.concat([v.min])),q=this.prepare(v.width,v.height),p=q.width(),q=q.height()-v.strokeWidth,r=p/(u.length-1),t=t-s,n=0==t?q:q/t,h=q+s*n,t=[0,h],o=0;o<u.length;o++){t.push(o*r,q-n*(u[o]-s)+v.strokeWidth/2)}t.push(p,h);u=c("polygon",{fill:v.fill,points:t.join(" ")});this.svg.appendChild(u);v.strokeWidth&&(v=c("polyline",{fill:"transparent",points:t.slice(2,t.length-2).join(" "),stroke:v.stroke,"stroke-width":v.strokeWidth,"stroke-linecap":"square"}),this.svg.appendChild(v))});f.register("bar",{delimiter:",",fill:["#4D89F9"],gap:1,height:16,max:null,min:0,width:32},function(z){for(var y=this.values(),x=g.max.apply(g,y.concat([z.max])),w=g.min.apply(g,y.concat([z.min])),u=this.prepare(z.width,z.height),t=u.width(),u=u.height(),v=x-w,r=0==v?0:u/v,z=z.gap,t=(t+z)/y.length,o=this.fill(),s=0;s<y.length;s++){var h=y[s],p=u-r*(h-w),q=r*h;if(0==q){if(q=a,0>=w&&0<x||0==v){p-=a}}else{0>q&&(p+=q,q=-q)}h=c("rect",{fill:o.call(this,h,s,y),x:s*t,y:p,width:t-z,height:q});this.svg.appendChild(h)}})})(jQuery,document,Math);