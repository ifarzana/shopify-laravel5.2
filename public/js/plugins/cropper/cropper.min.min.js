/*!
 * Cropper v0.7.6-beta
 * https://github.com/fengyuanchen/cropper
 *
 * Copyright 2014 Fengyuan Chen
 * Released under the MIT license
 */
;!function(b){"function"==typeof define&&define.amd?define(["jquery"],b):b("object"==typeof exports?require("jquery"):jQuery)}(function(aG){var aF=aG(window),aE=aG(document),aD=window.location,aC=!0,aB=!1,aA=null,az=0/0,ay=1/0,ax="undefined",aw="directive",av=".cropper",au=/^(e|n|w|s|ne|nw|sw|se|all|crop|move|zoom)$/,at=/^(x|y|width|height)$/,ar=/^(naturalWidth|naturalHeight|width|height|aspectRatio|ratio|rotate)$/,aq="cropper-modal",ap="cropper-hidden",ao="cropper-invisible",an="cropper-move",am="cropper-crop",al="cropper-disabled",ak="mousedown touchstart",aj="mousemove touchmove",ai="mouseup mouseleave touchend touchleave touchcancel",ah="wheel mousewheel DOMMouseScroll",ag="resize"+av,af="dblclick",ae="build"+av,ad="built"+av,ac="dragstart"+av,ab="dragmove"+av,aa="dragend"+av,Z=function(b){return"number"==typeof b},Y=function(a,d){this.element=a,this.$element=aG(a),this.defaults=aG.extend({},Y.DEFAULTS,aG.isPlainObject(d)?d:{}),this.$original=aA,this.ready=aB,this.built=aB,this.cropped=aB,this.rotated=aB,this.disabled=aB,this.replaced=aB,this.init()},X=Math.round,W=Math.sqrt,V=Math.min,U=Math.max,T=Math.abs,S=Math.sin,R=Math.cos,Q=parseFloat;Y.prototype={constructor:Y,support:{canvas:aG.isFunction(aG("<canvas>")[0].getContext)},init:function(){var a=this.defaults;aG.each(a,function(b,d){switch(b){case"aspectRatio":a[b]=T(Q(d))||az;break;case"autoCropArea":a[b]=T(Q(d))||0.8;break;case"minWidth":case"minHeight":a[b]=T(Q(d))||0;break;case"maxWidth":case"maxHeight":a[b]=T(Q(d))||ay}}),this.image={rotate:0},this.load()},load:function(){var a,n,m=this,l=this.$element,k=this.element,j=this.image,e="";l.is("img")?n=l.prop("src"):l.is("canvas")&&this.support.canvas&&(n=k.toDataURL()),n&&(this.replaced&&(j.rotate=0),this.defaults.checkImageOrigin&&(l.prop("crossOrigin")||this.isCrossOriginURL(n))&&(e=" crossOrigin"),this.$clone=a=aG("<img"+e+' src="'+n+'">'),a.one("load",function(){j.naturalWidth=this.naturalWidth||a.width(),j.naturalHeight=this.naturalHeight||a.height(),j.aspectRatio=j.naturalWidth/j.naturalHeight,m.url=n,m.ready=aC,m.build()}),a.addClass(ao).prependTo("body"))},isCrossOriginURL:function(d){var c=d.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return !c||c[1]===aD.protocol&&c[2]===aD.hostname&&c[3]===aD.port?aB:aC},build:function(){var a,h,e=this.$element,c=this.defaults;this.ready&&(this.built&&this.unbuild(),e.one(ae,c.build),a=aG.Event(ae),e.trigger(a),a.isDefaultPrevented()||(this.$cropper=h=aG(Y.TEMPLATE),e.addClass(ap),this.$clone.removeClass(ao).prependTo(h),this.rotated||(this.$original=this.$clone.clone(),this.$original.addClass(ap).prependTo(this.$cropper),this.originalImage=aG.extend({},this.image)),this.$container=e.parent(),this.$container.append(h),this.$canvas=h.find(".cropper-canvas"),this.$dragger=h.find(".cropper-dragger"),this.$viewer=h.find(".cropper-viewer"),c.autoCrop?this.cropped=aC:this.$dragger.addClass(ap),c.dragCrop&&this.setDragMode("crop"),c.modal&&this.$canvas.addClass(aq),!c.dashed&&this.$dragger.find(".cropper-dashed").addClass(ap),!c.movable&&this.$dragger.find(".cropper-face").data(aw,"move"),!c.resizable&&this.$dragger.find(".cropper-line, .cropper-point").addClass(ap),this.$scope=c.multiple?this.$cropper:aE,this.addListeners(),this.initPreview(),this.built=aC,this.update(),e.one(ad,c.built),e.trigger(ad)))},unbuild:function(){this.built&&(this.built=aB,this.removeListeners(),this.$preview.empty(),this.$preview=aA,this.$dragger=aA,this.$canvas=aA,this.$container=aA,this.$cropper.remove(),this.$cropper=aA)},update:function(b){this.initContainer(),this.initCropper(),this.initImage(),this.initDragger(),b?(this.setData(b,aC),this.setDragMode("crop")):this.setData(this.defaults.data)},resize:function(){clearTimeout(this.resizing),this.resizing=setTimeout(aG.proxy(this.update,this,this.getData()),200)},preview:function(){var a=this.image,l=this.dragger,k=a.width,j=a.height,i=l.left-a.left,h=l.top-a.top;this.$viewer.find("img").css({width:X(k),height:X(j),marginLeft:-X(i),marginTop:-X(h)}),this.$preview.each(function(){var c=aG(this),d=c.width()/l.width;c.find("img").css({width:X(k*d),height:X(j*d),marginLeft:-X(i*d),marginTop:-X(h*d)})})},addListeners:function(){var a=this.defaults;this.$element.on(ac,a.dragstart).on(ab,a.dragmove).on(aa,a.dragend),this.$cropper.on(ak,this._dragstart=aG.proxy(this.dragstart,this)).on(af,this._dblclick=aG.proxy(this.dblclick,this)),a.zoomable&&this.$cropper.on(ah,this._wheel=aG.proxy(this.wheel,this)),this.$scope.on(aj,this._dragmove=aG.proxy(this.dragmove,this)).on(ai,this._dragend=aG.proxy(this.dragend,this)),aF.on(ag,this._resize=aG.proxy(this.resize,this))},removeListeners:function(){var b=this.defaults;this.$element.off(ac,b.dragstart).off(ab,b.dragmove).off(aa,b.dragend),this.$cropper.off(ak,this._dragstart).off(af,this._dblclick),b.zoomable&&this.$cropper.off(ah,this._wheel),this.$scope.off(aj,this._dragmove).off(ai,this._dragend),aF.off(ag,this._resize)},initPreview:function(){var a='<img src="'+this.url+'">';this.$preview=aG(this.defaults.preview),this.$viewer.html(a),this.$preview.html(a).find("img").css("cssText","min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;")},initContainer:function(){var b=this.$container;this.container={width:U(b.width(),300),height:U(b.height(),150)}},initCropper:function(){var e,d=this.container,f=this.image;f.naturalWidth*d.height/f.naturalHeight-d.width>=0?(e={width:d.width,height:d.width/f.aspectRatio,left:0},e.top=(d.height-e.height)/2):(e={width:d.height*f.aspectRatio,height:d.height,top:0},e.left=(d.width-e.width)/2),this.$cropper.css({width:X(e.width),height:X(e.height),left:X(e.left),top:X(e.top)}),this.cropper=e},initImage:function(){var a=this.image,f=this.cropper,e={_width:f.width,_height:f.height,width:f.width,height:f.height,left:0,top:0,ratio:f.width/a.naturalWidth};this.defaultImage=aG.extend({},a,e),a._width!==f.width||a._height!==f.height?aG.extend(a,e):(a=aG.extend({},e,a),this.replaced&&(this.replaced=aB,a.ratio=e.ratio)),this.image=a,this.renderImage()},renderImage:function(d){var c=this.image;"zoom"===d&&(c.left-=(c.width-c.oldWidth)/2,c.top-=(c.height-c.oldHeight)/2),c.left=V(U(c.left,c._width-c.width),0),c.top=V(U(c.top,c._height-c.height),0),this.$clone.css({width:X(c.width),height:X(c.height),marginLeft:X(c.left),marginTop:X(c.top)}),d&&(this.defaults.done(this.getData()),this.preview())},initDragger:function(){var a,j=this.defaults,i=this.cropper,h=j.aspectRatio||this.image.aspectRatio,g=this.image.ratio;a=i.height*h-i.width>=0?{height:i.width/h,width:i.width,left:0,top:(i.height-i.width/h)/2,maxWidth:i.width,maxHeight:i.width/h}:{height:i.height,width:i.height*h,left:(i.width-i.height*h)/2,top:0,maxWidth:i.height*h,maxHeight:i.height},a.minWidth=0,a.minHeight=0,j.aspectRatio?(isFinite(j.maxWidth)?(a.maxWidth=V(a.maxWidth,j.maxWidth*g),a.maxHeight=a.maxWidth/h):isFinite(j.maxHeight)&&(a.maxHeight=V(a.maxHeight,j.maxHeight*g),a.maxWidth=a.maxHeight*h),j.minWidth>0?(a.minWidth=U(0,j.minWidth*g),a.minHeight=a.minWidth/h):j.minHeight>0&&(a.minHeight=U(0,j.minHeight*g),a.minWidth=a.minHeight*h)):(a.maxWidth=V(a.maxWidth,j.maxWidth*g),a.maxHeight=V(a.maxHeight,j.maxHeight*g),a.minWidth=U(0,j.minWidth*g),a.minHeight=U(0,j.minHeight*g)),a.minWidth=V(a.maxWidth,a.minWidth),a.minHeight=V(a.maxHeight,a.minHeight),a.height*=j.autoCropArea,a.width*=j.autoCropArea,a.left=(i.width-a.width)/2,a.top=(i.height-a.height)/2,a.oldLeft=a.left,a.oldTop=a.top,this.defaultDragger=a,this.dragger=aG.extend({},a)},renderDragger:function(){var d=this.dragger,c=this.cropper;d.width>d.maxWidth?(d.width=d.maxWidth,d.left=d.oldLeft):d.width<d.minWidth&&(d.width=d.minWidth,d.left=d.oldLeft),d.height>d.maxHeight?(d.height=d.maxHeight,d.top=d.oldTop):d.height<d.minHeight&&(d.height=d.minHeight,d.top=d.oldTop),d.left=V(U(d.left,0),c.width-d.width),d.top=V(U(d.top,0),c.height-d.height),d.oldLeft=d.left,d.oldTop=d.top,this.dragger=d,this.disabled||this.defaults.done(this.getData()),this.$dragger.css({width:X(d.width),height:X(d.height),left:X(d.left),top:X(d.top)}),this.preview()},reset:function(a){this.cropped&&(a&&(this.defaults.data={}),this.image=aG.extend({},this.defaultImage),this.renderImage(),this.dragger=aG.extend({},this.defaultDragger),this.setData(this.defaults.data))},clear:function(){this.cropped&&(this.cropped=aB,this.setData({x:0,y:0,width:0,height:0}),this.$canvas.removeClass(aq),this.$dragger.addClass(ap))},destroy:function(){var b=this.$element;this.ready&&(this.unbuild(),b.removeClass(ap).removeData("cropper"),this.rotated&&b.attr("src",this.$original.attr("src")))},replace:function(a,l){var k,j=this,f=this.$element,e=this.element;a&&a!==this.url&&a!==f.attr("src")&&(l||(this.rotated=aB,this.replaced=aC),f.is("img")?(f.attr("src",a),this.load()):f.is("canvas")&&this.support.canvas&&(k=e.getContext("2d"),aG('<img src="'+a+'">').one("load",function(){e.width=this.width,e.height=this.height,k.clearRect(0,0,e.width,e.height),k.drawImage(this,0,0),j.load()})))},setData:function(a,l){var k=this.cropper,j=this.dragger,i=this.image,g=this.defaults.aspectRatio;this.built&&typeof a!==ax&&((a===aA||aG.isEmptyObject(a))&&(j=aG.extend({},this.defaultDragger)),aG.isPlainObject(a)&&!aG.isEmptyObject(a)&&(l||(this.defaults.data=a),a=this.transformData(a),Z(a.x)&&a.x<=k.width-i.left&&(j.left=a.x+i.left),Z(a.y)&&a.y<=k.height-i.top&&(j.top=a.y+i.top),g?Z(a.width)&&a.width<=j.maxWidth&&a.width>=j.minWidth?(j.width=a.width,j.height=j.width/g):Z(a.height)&&a.height<=j.maxHeight&&a.height>=j.minHeight&&(j.height=a.height,j.width=j.height*g):(Z(a.width)&&a.width<=j.maxWidth&&a.width>=j.minWidth&&(j.width=a.width),Z(a.height)&&a.height<=j.maxHeight&&a.height>=j.minHeight&&(j.height=a.height))),this.dragger=j,this.renderDragger())},getData:function(f){var e=this.dragger,h=this.image,g={};return this.built&&(g={x:e.left-h.left,y:e.top-h.top,width:e.width,height:e.height},g=this.transformData(g,aC,f)),g},transformData:function(a,j,i){var h=this.image.ratio,g={};return aG.each(a,function(d,c){c=Q(c),at.test(d)&&!isNaN(c)&&(g[d]=j?i?X(c/h):c/h:c*h)}),g},setAspectRatio:function(d){var c="auto"===d;d=Q(d),(c||!isNaN(d)&&d>0)&&(this.defaults.aspectRatio=c?az:d,this.built&&(this.initDragger(),this.renderDragger()))},getImageData:function(){var a={};return this.ready&&aG.each(this.image,function(b,d){ar.test(b)&&(a[b]=d)}),a},getDataURL:function(a,n,m){var l,k=aG("<canvas>")[0],j=this.getData(),i="";return aG.isPlainObject(a)||(m=n,n=a,a={}),a=aG.extend({width:j.width,height:j.height},a),this.cropped&&this.support.canvas&&(k.width=a.width,k.height=a.height,l=k.getContext("2d"),"image/jpeg"===n&&(l.fillStyle="#fff",l.fillRect(0,0,a.width,a.height)),l.drawImage(this.$clone[0],j.x,j.y,j.width,j.height,0,0,a.width,a.height),i=k.toDataURL(n,m)),i},setDragMode:function(f){var e=this.$canvas,j=this.defaults,i=aB,h=aB;if(this.built&&!this.disabled){switch(f){case"crop":j.dragCrop&&(i=aC,e.data(aw,f));break;case"move":h=aC,e.data(aw,f);break;default:e.removeData(aw)}e.toggleClass(am,i).toggleClass(an,h)}},enable:function(){this.built&&(this.disabled=aB,this.$cropper.removeClass(al))},disable:function(){this.built&&(this.disabled=aC,this.$cropper.addClass(al))},rotate:function(d){var c=this.image;d=Q(d)||0,this.built&&0!==d&&!this.disabled&&this.defaults.rotatable&&this.support.canvas&&(this.rotated=aC,d=c.rotate=(c.rotate+d)%360,this.replace(this.getRotatedDataURL(d),!0))},getRotatedDataURL:function(x){var w=aG("<canvas>")[0],v=w.getContext("2d"),u=x*Math.PI/180,t=T(x)%180,s=t>90?180-t:t,r=s*Math.PI/180,q=this.originalImage,p=q.naturalWidth,o=q.naturalHeight,n=T(p*R(r)+o*S(r)),a=T(p*S(r)+o*R(r));return w.width=n,w.height=a,v.save(),v.translate(n/2,a/2),v.rotate(u),v.drawImage(this.$original[0],-p/2,-o/2,p,o),v.restore(),w.toDataURL()},zoom:function(g){var f,j,i,h=this.image;g=Q(g),this.built&&g&&!this.disabled&&this.defaults.zoomable&&(f=h.width*(1+g),j=h.height*(1+g),i=f/h._width,i>10||(1>i&&(f=h._width,j=h._height),this.setDragMode(1>=i?"crop":"move"),h.oldWidth=h.width,h.oldHeight=h.height,h.width=f,h.height=j,h.ratio=h.width/h.naturalWidth,this.renderImage("zoom")))},dblclick:function(){this.disabled||this.setDragMode(this.$canvas.hasClass(am)?"move":"crop")},wheel:function(i){var h,n=i.originalEvent,m=117.25,l=5,k=166.66665649414062,j=0.1;this.disabled||(i.preventDefault(),n.deltaY?(h=n.deltaY,h=h%l===0?h/l:h%m===0?h/m:h/k):h=n.wheelDelta?-n.wheelDelta/120:n.detail?n.detail/3:0,this.zoom(h*j))},dragstart:function(a){var l,k,j,f=a.originalEvent.touches,e=a;if(!this.disabled){if(f){if(j=f.length,j>1){if(!this.defaults.zoomable||2!==j){return}e=f[1],this.startX2=e.pageX,this.startY2=e.pageY,l="zoom"}e=f[0]}if(l=l||aG(e.target).data(aw),au.test(l)){if(a.preventDefault(),k=aG.Event(ac),this.$element.trigger(k),k.isDefaultPrevented()){return}this.directive=l,this.cropping=aB,this.startX=e.pageX,this.startY=e.pageY,"crop"===l&&(this.cropping=aC,this.$canvas.addClass(aq))}}},dragmove:function(a){var j,i,h=a.originalEvent.touches,g=a;if(!this.disabled){if(h){if(i=h.length,i>1){if(!this.defaults.zoomable||2!==i){return}g=h[1],this.endX2=g.pageX,this.endY2=g.pageY}g=h[0]}if(this.directive){if(a.preventDefault(),j=aG.Event(ab),this.$element.trigger(j),j.isDefaultPrevented()){return}this.endX=g.pageX,this.endY=g.pageY,this.dragging()}}},dragend:function(a){var d;if(!this.disabled&&this.directive){if(a.preventDefault(),d=aG.Event(aa),this.$element.trigger(d),d.isDefaultPrevented()){return}this.cropping&&(this.cropping=aB,this.$canvas.toggleClass(aq,this.cropped&&this.defaults.modal)),this.directive=""}},dragging:function(){var F,E=this.directive,D=this.image,C=this.cropper,B=C.width,A=C.height,z=this.dragger,y=z.width,x=z.height,w=z.left,v=z.top,u=w+y,q=v+x,f=aC,e=this.defaults,H=e.aspectRatio,G={x:this.endX-this.startX,y:this.endY-this.startY};switch(H&&(G.X=G.y*H,G.Y=G.x/H),E){case"all":w+=G.x,v+=G.y;break;case"e":if(G.x>=0&&(u>=B||H&&(0>=v||q>=A))){f=aB;break}y+=G.x,H&&(x=y/H,v-=G.Y/2),0>y&&(E="w",y=0);break;case"n":if(G.y<=0&&(0>=v||H&&(0>=w||u>=B))){f=aB;break}x-=G.y,v+=G.y,H&&(y=x*H,w+=G.X/2),0>x&&(E="s",x=0);break;case"w":if(G.x<=0&&(0>=w||H&&(0>=v||q>=A))){f=aB;break}y-=G.x,w+=G.x,H&&(x=y/H,v+=G.Y/2),0>y&&(E="e",y=0);break;case"s":if(G.y>=0&&(q>=A||H&&(0>=w||u>=B))){f=aB;break}x+=G.y,H&&(y=x*H,w-=G.X/2),0>x&&(E="n",x=0);break;case"ne":if(H){if(G.y<=0&&(0>=v||u>=B)){f=aB;break}x-=G.y,v+=G.y,y=x*H}else{G.x>=0?B>u?y+=G.x:G.y<=0&&0>=v&&(f=aB):y+=G.x,G.y<=0?v>0&&(x-=G.y,v+=G.y):(x-=G.y,v+=G.y)}0>x&&(E="sw",x=0,y=0);break;case"nw":if(H){if(G.y<=0&&(0>=v||0>=w)){f=aB;break}x-=G.y,v+=G.y,y=x*H,w+=G.X}else{G.x<=0?w>0?(y-=G.x,w+=G.x):G.y<=0&&0>=v&&(f=aB):(y-=G.x,w+=G.x),G.y<=0?v>0&&(x-=G.y,v+=G.y):(x-=G.y,v+=G.y)}0>x&&(E="se",x=0,y=0);break;case"sw":if(H){if(G.x<=0&&(0>=w||q>=A)){f=aB;break}y-=G.x,w+=G.x,x=y/H}else{G.x<=0?w>0?(y-=G.x,w+=G.x):G.y>=0&&q>=A&&(f=aB):(y-=G.x,w+=G.x),G.y>=0?A>q&&(x+=G.y):x+=G.y}0>y&&(E="ne",x=0,y=0);break;case"se":if(H){if(G.x>=0&&(u>=B||q>=A)){f=aB;break}y+=G.x,x=y/H}else{G.x>=0?B>u?y+=G.x:G.y>=0&&q>=A&&(f=aB):y+=G.x,G.y>=0?A>q&&(x+=G.y):x+=G.y}0>y&&(E="nw",x=0,y=0);break;case"move":D.left+=G.x,D.top+=G.y,this.renderImage("move"),f=aB;break;case"zoom":e.zoomable&&(this.zoom(function(h,g,l,k,j,i){return(W(j*j+i*i)-W(l*l+k*k))/W(h*h+g*g)}(D.width,D.height,T(this.startX-this.startX2),T(this.startY-this.startY2),T(this.endX-this.endX2),T(this.endY-this.endY2))),this.endX2=this.startX2,this.endY2=this.startY2);break;case"crop":G.x&&G.y&&(F=this.$cropper.offset(),w=this.startX-F.left,v=this.startY-F.top,y=z.minWidth,x=z.minHeight,G.x>0?G.y>0?E="se":(E="ne",v-=x):G.y>0?(E="sw",w-=y):(E="nw",w-=y,v-=x),this.cropped||(this.cropped=aC,this.$dragger.removeClass(ap)))}f&&(z.width=y,z.height=x,z.left=w,z.top=v,this.directive=E,this.renderDragger()),this.startX=this.endX,this.startY=this.endY}},Y.TEMPLATE=function(d,c){return c=c.split(","),d.replace(/\d+/g,function(b){return c[b]})}('<0 6="5-container"><0 6="5-canvas"></0><0 6="5-dragger"><1 6="5-viewer"></1><1 6="5-8 8-h"></1><1 6="5-8 8-v"></1><1 6="5-face" 3-2="all"></1><1 6="5-7 7-e" 3-2="e"></1><1 6="5-7 7-n" 3-2="n"></1><1 6="5-7 7-w" 3-2="w"></1><1 6="5-7 7-s" 3-2="s"></1><1 6="5-4 4-e" 3-2="e"></1><1 6="5-4 4-n" 3-2="n"></1><1 6="5-4 4-w" 3-2="w"></1><1 6="5-4 4-s" 3-2="s"></1><1 6="5-4 4-ne" 3-2="ne"></1><1 6="5-4 4-nw" 3-2="nw"></1><1 6="5-4 4-sw" 3-2="sw"></1><1 6="5-4 4-se" 3-2="se"></1></0></0>',"div,span,directive,data,point,cropper,class,line,dashed"),Y.DEFAULTS={aspectRatio:"auto",autoCropArea:0.8,data:{},done:aG.noop,preview:"",multiple:aB,autoCrop:aC,dragCrop:aC,dashed:aC,modal:aC,movable:aC,resizable:aC,zoomable:aC,rotatable:aC,checkImageOrigin:aC,minWidth:0,minHeight:0,maxWidth:ay,maxHeight:ay,build:aA,built:aA,dragstart:aA,dragmove:aA,dragend:aA},Y.setDefaults=function(a){aG.extend(Y.DEFAULTS,a)},Y.other=aG.fn.cropper,aG.fn.cropper=function(a){var f,e=[].slice.call(arguments,1);return this.each(function(){var d,c=aG(this),b=c.data("cropper");b||c.data("cropper",b=new Y(this,a)),"string"==typeof a&&aG.isFunction(d=b[a])&&(f=d.apply(b,e))}),typeof f!==ax?f:this},aG.fn.cropper.Constructor=Y,aG.fn.cropper.setDefaults=Y.setDefaults,aG.fn.cropper.noConflict=function(){return aG.fn.cropper=Y.other,this}});