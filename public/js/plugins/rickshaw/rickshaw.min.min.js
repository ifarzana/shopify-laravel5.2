(function(a,b){if(typeof define==="function"&&define.amd){define(["d3"],function(c){return a.Rickshaw=b(c)})}else{if(typeof exports==="object"){module.exports=b(require("d3"))}else{a.Rickshaw=b(d3)}}})(this,function(b){var a={namespace:function(f,j){var h=f.split(".");var e=a;for(var d=1,g=h.length;d<g;d++){var c=h[d];e[c]=e[c]||{};e=e[c]}return e},keys:function(e){var d=[];for(var c in e){d.push(c)}return d},extend:function(c,e){for(var d in e){c[d]=e[d]}return c},clone:function(c){return JSON.parse(JSON.stringify(c))}};(function(x){var u=Object.prototype.toString,t="Null",k="Undefined",p="Boolean",e="Number",n="String",v="Object",o="[object Function]";function c(y){return u.call(y)===o}function s(y,A){for(var z in A){if(A.hasOwnProperty(z)){y[z]=A[z]}}return y}function m(y){if(j(y)!==v){throw new TypeError}var z=[];for(var A in y){if(y.hasOwnProperty(A)){z.push(A)}}return z}function j(z){switch(z){case null:return t;case void 0:return k}var y=typeof z;switch(y){case"boolean":return p;case"number":return e;case"string":return n}return v}function d(y){return typeof y==="undefined"}var q=Array.prototype.slice;function g(y){var z=y.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return z.length==1&&!z[0]?[]:z}function i(z,A){var y=z;return function(){var B=h([w(y,this)],arguments);return A.apply(this,B)}}function h(B,y){var A=B.length,z=y.length;while(z--){B[A+z]=y[z]}return B}function f(z,y){z=q.call(z,0);return h(z,y)}function w(B,A){if(arguments.length<2&&d(arguments[0])){return this}var y=B,z=q.call(arguments,2);return function(){var C=f(z,arguments);return y.apply(A,C)}}var l=function(){};var r=function(){var B=function(){for(var C in {toString:1}){if(C==="toString"){return false}}return true}();function y(){}function z(){var F=null,E=[].slice.apply(arguments);if(c(E[0])){F=E.shift()}function C(){this.initialize.apply(this,arguments)}s(C,r.Methods);C.superclass=F;C.subclasses=[];if(F){y.prototype=F.prototype;C.prototype=new y;try{F.subclasses.push(C)}catch(H){}}for(var D=0,G=E.length;D<G;D++){C.addMethods(E[D])}if(!C.prototype.initialize){C.prototype.initialize=l}C.prototype.constructor=C;return C}function A(I){var E=this.superclass&&this.superclass.prototype,D=m(I);if(B){if(I.toString!=Object.prototype.toString){D.push("toString")}if(I.valueOf!=Object.prototype.valueOf){D.push("valueOf")}}for(var C=0,F=D.length;C<F;C++){var H=D[C],G=I[H];if(E&&c(G)&&g(G)[0]=="$super"){var J=G;G=i(function(K){return function(){return E[K].apply(this,arguments)}}(H),J);G.valueOf=w(J.valueOf,J);G.toString=w(J.toString,J)}this.prototype[H]=G}return this}return{create:z,Methods:{addMethods:A}}}();if(x.exports){x.exports.Class=r}else{x.Class=r}})(a);a.namespace("Rickshaw.Compat.ClassList");a.Compat.ClassList=function(){if(typeof document!=="undefined"&&!("classList" in document.createElement("a"))){(function(l){var c="classList",h="prototype",o=(l.HTMLElement||l.Element)[h],d=Object,m=String[h].trim||function(){return this.replace(/^\s+|\s+$/g,"")},e=Array[h].indexOf||function(s){var r=0,q=this.length;for(;r<q;r++){if(r in this&&this[r]===s){return r}}return -1},p=function(q,r){this.name=q;this.code=DOMException[q];this.message=r},i=function(r,q){if(q===""){throw new p("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(q)){throw new p("INVALID_CHARACTER_ERR","String contains an invalid character")}return e.call(r,q)},f=function(u){var t=m.call(u.className),s=t?t.split(/\s+/):[],r=0,q=s.length;for(;r<q;r++){this.push(s[r])}this._updateClassName=function(){u.className=this.toString()}},g=f[h]=[],k=function(){return new f(this)};p[h]=Error[h];g.item=function(q){return this[q]||null};g.contains=function(q){q+="";return i(this,q)!==-1};g.add=function(q){q+="";if(i(this,q)===-1){this.push(q);this._updateClassName()}};g.remove=function(r){r+="";var q=i(this,r);if(q!==-1){this.splice(q,1);this._updateClassName()}};g.toggle=function(q){q+="";if(i(this,q)===-1){this.add(q)}else{this.remove(q)}};g.toString=function(){return this.join(" ")};if(d.defineProperty){var n={get:k,enumerable:true,configurable:true};try{d.defineProperty(o,c,n)}catch(j){if(j.number===-2146823252){n.enumerable=false;d.defineProperty(o,c,n)}}}else{if(d[h].__defineGetter__){o.__defineGetter__(c,k)}}})(window)}};if(typeof RICKSHAW_NO_COMPAT!=="undefined"&&!RICKSHAW_NO_COMPAT||typeof RICKSHAW_NO_COMPAT==="undefined"){new a.Compat.ClassList}a.namespace("Rickshaw.Graph");a.Graph=function(d){var c=this;this.initialize=function(e){if(!e.element){throw"Rickshaw.Graph needs a reference to an element"}if(e.element.nodeType!==1){throw"Rickshaw.Graph element was defined but not an HTML element"}this.element=e.element;this.series=e.series;this.window={};this.updateCallbacks=[];this.configureCallbacks=[];this.defaults={interpolation:"cardinal",offset:"zero",min:undefined,max:undefined,preserve:false,xScale:undefined,yScale:undefined,stack:true};this._loadRenderers();this.configure(e);this.validateSeries(e.series);this.series.active=function(){return c.series.filter(function(f){return !f.disabled})};this.setSize({width:e.width,height:e.height});this.element.classList.add("rickshaw_graph");this.vis=b.select(this.element).append("svg:svg").attr("width",this.width).attr("height",this.height);this.discoverRange()};this._loadRenderers=function(){for(var e in a.Graph.Renderer){if(!e||!a.Graph.Renderer.hasOwnProperty(e)){continue}var f=a.Graph.Renderer[e];if(!f||!f.prototype||!f.prototype.render){continue}c.registerRenderer(new f({graph:c}))}};this.validateSeries=function(f){if(!Array.isArray(f)&&!(f instanceof a.Series)){var e=Object.prototype.toString.apply(f);throw"series is not an array: "+e}var g;f.forEach(function(i){if(!(i instanceof Object)){throw"series element is not an object: "+i}if(!i.data){throw"series has no data: "+JSON.stringify(i)}if(!Array.isArray(i.data)){throw"series data is not an array: "+JSON.stringify(i.data)}if(i.data.length>0){var h=i.data[0].x;var j=i.data[0].y;if(typeof h!="number"||typeof j!="number"&&j!==null){throw"x and y properties of points should be numbers instead of "+typeof h+" and "+typeof j}}if(i.data.length>=3){if(i.data[2].x<i.data[1].x||i.data[1].x<i.data[0].x||i.data[i.data.length-1].x<i.data[0].x){throw"series data needs to be sorted on x values for series name: "+i.name}}},this)};this.dataDomain=function(){var g=this.series.map(function(h){return h.data});var f=b.min(g.map(function(h){return h[0].x}));var e=b.max(g.map(function(h){return h[h.length-1].x}));return[f,e]};this.discoverRange=function(){var e=this.renderer.domain();this.x=(this.xScale||b.scale.linear()).copy().domain(e.x).range([0,this.width]);this.y=(this.yScale||b.scale.linear()).copy().domain(e.y).range([this.height,0]);this.x.magnitude=b.scale.linear().domain([e.x[0]-e.x[0],e.x[1]-e.x[0]]).range([0,this.width]);this.y.magnitude=b.scale.linear().domain([e.y[0]-e.y[0],e.y[1]-e.y[0]]).range([0,this.height])};this.render=function(){var e=this.stackData();this.discoverRange();this.renderer.render();this.updateCallbacks.forEach(function(f){f()})};this.update=this.render;this.stackData=function(){var j=this.series.active().map(function(i){return i.data}).map(function(i){return i.filter(function(k){return this._slice(k)},this)},this);var g=this.preserve;if(!g){this.series.forEach(function(i){if(i.scale){g=true}})}j=g?a.clone(j):j;this.series.active().forEach(function(l,i){if(l.scale){var k=j[i];if(k){k.forEach(function(m){m.y=l.scale(m.y)})}}});this.stackData.hooks.data.forEach(function(i){j=i.f.apply(c,[j])});var f;if(!this.renderer.unstack){this._validateStackable();var h=b.layout.stack();h.offset(c.offset);f=h(j)}f=f||j;if(this.renderer.unstack){f.forEach(function(i){i.forEach(function(k){k.y0=k.y0===undefined?0:k.y0})})}this.stackData.hooks.after.forEach(function(i){f=i.f.apply(c,[j])});var e=0;this.series.forEach(function(i){if(i.disabled){return}i.stack=f[e++]});this.stackedData=f;return f};this._validateStackable=function(){var e=this.series;var f;e.forEach(function(g){f=f||g.data.length;if(f&&g.data.length!=f){throw"stacked series cannot have differing numbers of points: "+f+" vs "+g.data.length+"; see Rickshaw.Series.fill()"}},this)};this.stackData.hooks={data:[],after:[]};this._slice=function(f){if(this.window.xMin||this.window.xMax){var e=true;if(this.window.xMin&&f.x<this.window.xMin){e=false}if(this.window.xMax&&f.x>this.window.xMax){e=false}return e}return true};this.onUpdate=function(e){this.updateCallbacks.push(e)};this.onConfigure=function(e){this.configureCallbacks.push(e)};this.registerRenderer=function(e){this._renderers=this._renderers||{};this._renderers[e.name]=e};this.configure=function(e){this.config=this.config||{};if(e.width||e.height){this.setSize(e)}a.keys(this.defaults).forEach(function(g){this.config[g]=g in e?e[g]:g in this?this[g]:this.defaults[g]},this);a.keys(this.config).forEach(function(g){this[g]=this.config[g]},this);if("stack" in e){e.unstack=!e.stack}var f=e.renderer||this.renderer&&this.renderer.name||"stack";this.setRenderer(f,e);this.configureCallbacks.forEach(function(g){g(e)})};this.setRenderer=function(f,e){if(typeof f=="function"){this.renderer=new f({graph:c});this.registerRenderer(this.renderer)}else{if(!this._renderers[f]){throw"couldn't find renderer "+f}this.renderer=this._renderers[f]}if(typeof e=="object"){this.renderer.configure(e)}};this.setSize=function(e){e=e||{};if(typeof window!==undefined){var g=window.getComputedStyle(this.element,null);var h=parseInt(g.getPropertyValue("width"),10);var f=parseInt(g.getPropertyValue("height"),10)}this.width=e.width||h||400;this.height=e.height||f||250;this.vis&&this.vis.attr("width",this.width).attr("height",this.height)};this.initialize(d)};a.namespace("Rickshaw.Fixtures.Color");a.Fixtures.Color=function(){this.schemes={};this.schemes.spectrum14=["#ecb796","#dc8f70","#b2a470","#92875a","#716c49","#d2ed82","#bbe468","#a1d05d","#e7cbe6","#d8aad6","#a888c2","#9dc2d3","#649eb9","#387aa3"].reverse();this.schemes.spectrum2000=["#57306f","#514c76","#646583","#738394","#6b9c7d","#84b665","#a7ca50","#bfe746","#e2f528","#fff726","#ecdd00","#d4b11d","#de8800","#de4800","#c91515","#9a0000","#7b0429","#580839","#31082b"];this.schemes.spectrum2001=["#2f243f","#3c2c55","#4a3768","#565270","#6b6b7c","#72957f","#86ad6e","#a1bc5e","#b8d954","#d3e04e","#ccad2a","#cc8412","#c1521d","#ad3821","#8a1010","#681717","#531e1e","#3d1818","#320a1b"];this.schemes.classic9=["#423d4f","#4a6860","#848f39","#a2b73c","#ddcb53","#c5a32f","#7d5836","#963b20","#7c2626","#491d37","#2f254a"].reverse();this.schemes.httpStatus={503:"#ea5029",502:"#d23f14",500:"#bf3613",410:"#efacea",409:"#e291dc",403:"#f457e8",408:"#e121d2",401:"#b92dae",405:"#f47ceb",404:"#a82a9f",400:"#b263c6",301:"#6fa024",302:"#87c32b",307:"#a0d84c",304:"#28b55c",200:"#1a4f74",206:"#27839f",201:"#52adc9",202:"#7c979f",203:"#a5b8bd",204:"#c1cdd1"};this.schemes.colorwheel=["#b5b6a9","#858772","#785f43","#96557e","#4682b4","#65b9ac","#73c03a","#cb513a"].reverse();this.schemes.cool=["#5e9d2f","#73c03a","#4682b4","#7bc3b8","#a9884e","#c1b266","#a47493","#c09fb5"];this.schemes.munin=["#00cc00","#0066b3","#ff8000","#ffcc00","#330099","#990099","#ccff00","#ff0000","#808080","#008f00","#00487d","#b35a00","#b38f00","#6b006b","#8fb300","#b30000","#bebebe","#80ff80","#80c9ff","#ffc080","#ffe680","#aa80ff","#ee00cc","#ff8080","#666600","#ffbfff","#00ffcc","#cc6699","#999900"]};a.namespace("Rickshaw.Fixtures.RandomData");a.Fixtures.RandomData=function(d){var f;d=d||1;var c=200;var e=Math.floor((new Date).getTime()/1000);this.addData=function(j){var i=Math.random()*100+15+c;var h=j[0].length;var g=1;j.forEach(function(l){var m=Math.random()*20;var k=i/25+g+++(Math.cos(h*g*11/960)+2)*15+(Math.cos(h/7)+2)*7+(Math.cos(h/17)+2)*1;l.push({x:h*d+e,y:k+m})});c=i*0.85};this.removeData=function(g){g.forEach(function(h){h.shift()});e+=d}};a.namespace("Rickshaw.Fixtures.Time");a.Fixtures.Time=function(){var c=this;this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.units=[{name:"decade",seconds:86400*365.25*10,formatter:function(e){return parseInt(e.getUTCFullYear()/10,10)*10}},{name:"year",seconds:86400*365.25,formatter:function(e){return e.getUTCFullYear()}},{name:"month",seconds:86400*30.5,formatter:function(e){return c.months[e.getUTCMonth()]}},{name:"week",seconds:86400*7,formatter:function(e){return c.formatDate(e)}},{name:"day",seconds:86400,formatter:function(e){return e.getUTCDate()}},{name:"6 hour",seconds:3600*6,formatter:function(e){return c.formatTime(e)}},{name:"hour",seconds:3600,formatter:function(e){return c.formatTime(e)}},{name:"15 minute",seconds:60*15,formatter:function(e){return c.formatTime(e)}},{name:"minute",seconds:60,formatter:function(e){return e.getUTCMinutes()}},{name:"15 second",seconds:15,formatter:function(e){return e.getUTCSeconds()+"s"}},{name:"second",seconds:1,formatter:function(e){return e.getUTCSeconds()+"s"}},{name:"decisecond",seconds:1/10,formatter:function(e){return e.getUTCMilliseconds()+"ms"}},{name:"centisecond",seconds:1/100,formatter:function(e){return e.getUTCMilliseconds()+"ms"}}];this.unit=function(d){return this.units.filter(function(e){return d==e.name}).shift()};this.formatDate=function(e){return b.time.format("%b %e")(e)};this.formatTime=function(e){return e.toUTCString().match(/(\d+:\d+):/)[1]};this.ceil=function(i,g){var d,f,e;if(g.name=="month"){d=new Date(i*1000);f=Date.UTC(d.getUTCFullYear(),d.getUTCMonth())/1000;if(f==i){return i}e=d.getUTCFullYear();var h=d.getUTCMonth();if(h==11){h=0;e=e+1}else{h+=1}return Date.UTC(e,h)/1000}if(g.name=="year"){d=new Date(i*1000);f=Date.UTC(d.getUTCFullYear(),0)/1000;if(f==i){return i}e=d.getUTCFullYear()+1;return Date.UTC(e,0)/1000}return Math.ceil(i/g.seconds)*g.seconds}};a.namespace("Rickshaw.Fixtures.Time.Local");a.Fixtures.Time.Local=function(){var c=this;this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.units=[{name:"decade",seconds:86400*365.25*10,formatter:function(e){return parseInt(e.getFullYear()/10,10)*10}},{name:"year",seconds:86400*365.25,formatter:function(e){return e.getFullYear()}},{name:"month",seconds:86400*30.5,formatter:function(e){return c.months[e.getMonth()]}},{name:"week",seconds:86400*7,formatter:function(e){return c.formatDate(e)}},{name:"day",seconds:86400,formatter:function(e){return e.getDate()}},{name:"6 hour",seconds:3600*6,formatter:function(e){return c.formatTime(e)}},{name:"hour",seconds:3600,formatter:function(e){return c.formatTime(e)}},{name:"15 minute",seconds:60*15,formatter:function(e){return c.formatTime(e)}},{name:"minute",seconds:60,formatter:function(e){return e.getMinutes()}},{name:"15 second",seconds:15,formatter:function(e){return e.getSeconds()+"s"}},{name:"second",seconds:1,formatter:function(e){return e.getSeconds()+"s"}},{name:"decisecond",seconds:1/10,formatter:function(e){return e.getMilliseconds()+"ms"}},{name:"centisecond",seconds:1/100,formatter:function(e){return e.getMilliseconds()+"ms"}}];this.unit=function(d){return this.units.filter(function(e){return d==e.name}).shift()};this.formatDate=function(e){return b.time.format("%b %e")(e)};this.formatTime=function(e){return e.toString().match(/(\d+:\d+):/)[1]};this.ceil=function(k,h){var e,g,f;if(h.name=="day"){var i=new Date((k+h.seconds-1)*1000);var d=new Date(0);d.setMilliseconds(0);d.setSeconds(0);d.setMinutes(0);d.setHours(0);d.setDate(i.getDate());d.setMonth(i.getMonth());d.setFullYear(i.getFullYear());return d.getTime()/1000}if(h.name=="month"){e=new Date(k*1000);g=new Date(e.getFullYear(),e.getMonth()).getTime()/1000;if(g==k){return k}f=e.getFullYear();var j=e.getMonth();if(j==11){j=0;f=f+1}else{j+=1}return new Date(f,j).getTime()/1000}if(h.name=="year"){e=new Date(k*1000);g=new Date(e.getUTCFullYear(),0).getTime()/1000;if(g==k){return k}f=e.getFullYear()+1;return new Date(f,0).getTime()/1000}return Math.ceil(k/h.seconds)*h.seconds}};a.namespace("Rickshaw.Fixtures.Number");a.Fixtures.Number.formatKMBT=function(d){var c=Math.abs(d);if(c>=1000000000000){return d/1000000000000+"T"}else{if(c>=1000000000){return d/1000000000+"B"}else{if(c>=1000000){return d/1000000+"M"}else{if(c>=1000){return d/1000+"K"}else{if(c<1&&d>0){return d.toFixed(2)}else{if(c===0){return""}else{return d}}}}}}};a.Fixtures.Number.formatBase1024KMGTP=function(d){var c=Math.abs(d);if(c>=1125899906842624){return d/1125899906842624+"P"}else{if(c>=1099511627776){return d/1099511627776+"T"}else{if(c>=1073741824){return d/1073741824+"G"}else{if(c>=1048576){return d/1048576+"M"}else{if(c>=1024){return d/1024+"K"}else{if(c<1&&d>0){return d.toFixed(2)}else{if(c===0){return""}else{return d}}}}}}}};a.namespace("Rickshaw.Color.Palette");a.Color.Palette=function(g){var d=new a.Fixtures.Color;g=g||{};this.schemes={};this.scheme=d.schemes[g.scheme]||g.scheme||d.schemes.colorwheel;this.runningIndex=0;this.generatorIndex=0;if(g.interpolatedStopCount){var f=this.scheme.length-1;var h,e,c=[];for(h=0;h<f;h++){c.push(this.scheme[h]);var k=b.interpolateHsl(this.scheme[h],this.scheme[h+1]);for(e=1;e<g.interpolatedStopCount;e++){c.push(k(1/g.interpolatedStopCount*e))}}c.push(this.scheme[this.scheme.length-1]);this.scheme=c}this.rotateCount=this.scheme.length;this.color=function(i){return this.scheme[i]||this.scheme[this.runningIndex++]||this.interpolateColor()||"#808080"};this.interpolateColor=function(){if(!Array.isArray(this.scheme)){return}var i;if(this.generatorIndex==this.rotateCount*2-1){i=b.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[0])(0.5);this.generatorIndex=0;this.rotateCount*=2}else{i=b.interpolateHsl(this.scheme[this.generatorIndex],this.scheme[this.generatorIndex+1])(0.5);this.generatorIndex++}this.scheme.push(i);return i}};a.namespace("Rickshaw.Graph.Ajax");a.Graph.Ajax=a.Class.create({initialize:function(c){this.dataURL=c.dataURL;this.onData=c.onData||function(e){return e};this.onComplete=c.onComplete||function(){};this.onError=c.onError||function(){};this.args=c;this.request()},request:function(){jQuery.ajax({url:this.dataURL,dataType:"json",success:this.success.bind(this),error:this.error.bind(this)})},error:function(){console.log("error loading dataURL: "+this.dataURL);this.onError(this)},success:function(d,c){d=this.onData(d);this.args.series=this._splice({data:d,series:this.args.series});this.graph=this.graph||new a.Graph(this.args);this.graph.render();this.onComplete(this)},_splice:function(c){var e=c.data;var d=c.series;if(!c.series){return e}d.forEach(function(g){var f=g.key||g.name;if(!f){throw"series needs a key or a name"}e.forEach(function(j){var i=j.key||j.name;if(!i){throw"data needs a key or a name"}if(f==i){var h=["color","name","data"];h.forEach(function(k){if(j[k]){g[k]=j[k]}})}})});return d}});a.namespace("Rickshaw.Graph.Annotate");a.Graph.Annotate=function(d){var e=this.graph=d.graph;this.elements={intimeline:d.element};var c=this;this.data={};this.elements.intimeline.classList.add("rickshaw_annotation_intimeline");this.add=function(h,g,f){c.data[h]=c.data[h]||{boxes:[]};c.data[h].boxes.push({content:g,end:f})};this.update=function(){a.keys(c.data).forEach(function(i){var f=c.data[i];var h=c.graph.x(i);if(h<0||h>c.graph.x.range()[1]){if(f.element){f.line.classList.add("offscreen");f.element.style.display="none"}f.boxes.forEach(function(j){if(j.rangeElement){j.rangeElement.classList.add("offscreen")}});return}if(!f.element){var g=f.element=document.createElement("div");g.classList.add("annotation");this.elements.intimeline.appendChild(g);g.addEventListener("click",function(j){g.classList.toggle("active");f.line.classList.toggle("active");f.boxes.forEach(function(k){if(k.rangeElement){k.rangeElement.classList.toggle("active")}})},false)}f.element.style.left=h+"px";f.element.style.display="block";f.boxes.forEach(function(l){var k=l.element;if(!k){k=l.element=document.createElement("div");k.classList.add("content");k.innerHTML=l.content;f.element.appendChild(k);f.line=document.createElement("div");f.line.classList.add("annotation_line");c.graph.element.appendChild(f.line);if(l.end){l.rangeElement=document.createElement("div");l.rangeElement.classList.add("annotation_range");c.graph.element.appendChild(l.rangeElement)}}if(l.end){var m=h;var n=Math.min(c.graph.x(l.end),c.graph.x.range()[1]);if(m>n){n=h;m=Math.max(c.graph.x(l.end),c.graph.x.range()[0])}var j=n-m;l.rangeElement.style.left=m+"px";l.rangeElement.style.width=j+"px";l.rangeElement.classList.remove("offscreen")}f.line.classList.remove("offscreen");f.line.style.left=h+"px"})},this)};this.graph.onUpdate(function(){c.update()})};a.namespace("Rickshaw.Graph.Axis.Time");a.Graph.Axis.Time=function(d){var c=this;this.graph=d.graph;this.elements=[];this.ticksTreatment=d.ticksTreatment||"plain";this.fixedTimeUnit=d.timeUnit;var e=d.timeFixture||new a.Fixtures.Time;this.appropriateTimeUnit=function(){var h;var g=e.units;var i=this.graph.x.domain();var f=i[1]-i[0];g.forEach(function(j){if(Math.floor(f/j.seconds)>=2){h=h||j}});return h||e.units[e.units.length-1]};this.tickOffsets=function(){var m=this.graph.x.domain();var l=this.fixedTimeUnit||this.appropriateTimeUnit();var k=Math.ceil((m[1]-m[0])/l.seconds);var f=m[0];var j=[];for(var h=0;h<k;h++){var g=e.ceil(f,l);f=g+l.seconds/2;j.push({value:g,unit:l})}return j};this.render=function(){this.elements.forEach(function(g){g.parentNode.removeChild(g)});this.elements=[];var f=this.tickOffsets();f.forEach(function(i){if(c.graph.x(i.value)>c.graph.x.range()[1]){return}var g=document.createElement("div");g.style.left=c.graph.x(i.value)+"px";g.classList.add("x_tick");g.classList.add(c.ticksTreatment);var h=document.createElement("div");h.classList.add("title");h.innerHTML=i.unit.formatter(new Date(i.value*1000));g.appendChild(h);c.graph.element.appendChild(g);c.elements.push(g)})};this.graph.onUpdate(function(){c.render()})};a.namespace("Rickshaw.Graph.Axis.X");a.Graph.Axis.X=function(d){var c=this;var e=0.1;this.initialize=function(f){this.graph=f.graph;this.orientation=f.orientation||"top";this.pixelsPerTick=f.pixelsPerTick||75;if(f.ticks){this.staticTicks=f.ticks}if(f.tickValues){this.tickValues=f.tickValues}this.tickSize=f.tickSize||4;this.ticksTreatment=f.ticksTreatment||"plain";if(f.element){this.element=f.element;this._discoverSize(f.element,f);this.vis=b.select(f.element).append("svg:svg").attr("height",this.height).attr("width",this.width).attr("class","rickshaw_graph x_axis_d3");this.element=this.vis[0][0];this.element.style.position="relative";this.setSize({width:f.width,height:f.height})}else{this.vis=this.graph.vis}this.graph.onUpdate(function(){c.render()})};this.setSize=function(g){g=g||{};if(!this.element){return}this._discoverSize(this.element.parentNode,g);this.vis.attr("height",this.height).attr("width",this.width*(1+e));var f=Math.floor(this.width*e/2);this.element.style.left=-1*f+"px"};this.render=function(){if(this._renderWidth!==undefined&&this.graph.width!==this._renderWidth){this.setSize({auto:true})}var i=b.svg.axis().scale(this.graph.x).orient(this.orientation);i.tickFormat(d.tickFormat||function(k){return k});if(this.tickValues){i.tickValues(this.tickValues)}this.ticks=this.staticTicks||Math.floor(this.graph.width/this.pixelsPerTick);var f=Math.floor(this.width*e/2)||0;var h;if(this.orientation=="top"){var j=this.height||this.graph.height;h="translate("+f+","+j+")"}else{h="translate("+f+", 0)"}if(this.element){this.vis.selectAll("*").remove()}this.vis.append("svg:g").attr("class",["x_ticks_d3",this.ticksTreatment].join(" ")).attr("transform",h).call(i.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize));var g=(this.orientation=="bottom"?1:-1)*this.graph.height;this.graph.vis.append("svg:g").attr("class","x_grid_d3").call(i.ticks(this.ticks).tickSubdivide(0).tickSize(g)).selectAll("text").each(function(){this.parentNode.setAttribute("data-x-value",this.textContent)});this._renderHeight=this.graph.height};this._discoverSize=function(g,f){if(typeof window!=="undefined"){var i=window.getComputedStyle(g,null);var h=parseInt(i.getPropertyValue("height"),10);if(!f.auto){var j=parseInt(i.getPropertyValue("width"),10)}}this.width=(f.width||j||this.graph.width)*(1+e);this.height=f.height||h||40};this.initialize(d)};a.namespace("Rickshaw.Graph.Axis.Y");a.Graph.Axis.Y=a.Class.create({initialize:function(d){this.graph=d.graph;this.orientation=d.orientation||"right";this.pixelsPerTick=d.pixelsPerTick||75;if(d.ticks){this.staticTicks=d.ticks}if(d.tickValues){this.tickValues=d.tickValues}this.tickSize=d.tickSize||4;this.ticksTreatment=d.ticksTreatment||"plain";this.tickFormat=d.tickFormat||function(e){return e};this.berthRate=0.1;if(d.element){this.element=d.element;this.vis=b.select(d.element).append("svg:svg").attr("class","rickshaw_graph y_axis");this.element=this.vis[0][0];this.element.style.position="relative";this.setSize({width:d.width,height:d.height})}else{this.vis=this.graph.vis}var c=this;this.graph.onUpdate(function(){c.render()})},setSize:function(d){d=d||{};if(!this.element){return}if(typeof window!=="undefined"){var f=window.getComputedStyle(this.element.parentNode,null);var g=parseInt(f.getPropertyValue("width"),10);if(!d.auto){var e=parseInt(f.getPropertyValue("height"),10)}}this.width=d.width||g||this.graph.width*this.berthRate;this.height=d.height||e||this.graph.height;this.vis.attr("width",this.width).attr("height",this.height*(1+this.berthRate));var c=this.height*this.berthRate;if(this.orientation=="left"){this.element.style.top=-1*c+"px"}},render:function(){if(this._renderHeight!==undefined&&this.graph.height!==this._renderHeight){this.setSize({auto:true})}this.ticks=this.staticTicks||Math.floor(this.graph.height/this.pixelsPerTick);var c=this._drawAxis(this.graph.y);this._drawGrid(c);this._renderHeight=this.graph.height},_drawAxis:function(f){var e=b.svg.axis().scale(f).orient(this.orientation);e.tickFormat(this.tickFormat);if(this.tickValues){e.tickValues(this.tickValues)}if(this.orientation=="left"){var c=this.height*this.berthRate;var d="translate("+this.width+", "+c+")"}if(this.element){this.vis.selectAll("*").remove()}this.vis.append("svg:g").attr("class",["y_ticks",this.ticksTreatment].join(" ")).attr("transform",d).call(e.ticks(this.ticks).tickSubdivide(0).tickSize(this.tickSize));return e},_drawGrid:function(d){var c=(this.orientation=="right"?1:-1)*this.graph.width;this.graph.vis.append("svg:g").attr("class","y_grid").call(d.ticks(this.ticks).tickSubdivide(0).tickSize(c)).selectAll("text").each(function(){this.parentNode.setAttribute("data-y-value",this.textContent)})}});a.namespace("Rickshaw.Graph.Axis.Y.Scaled");a.Graph.Axis.Y.Scaled=a.Class.create(a.Graph.Axis.Y,{initialize:function($super,c){if(typeof c.scale==="undefined"){throw new Error("Scaled requires scale")}this.scale=c.scale;if(typeof c.grid==="undefined"){this.grid=true}else{this.grid=c.grid}$super(c)},_drawAxis:function($super,e){var g=this.scale.domain();var d=this.graph.renderer.domain().y;var i=[Math.min.apply(Math,g),Math.max.apply(Math,g)];var f=b.scale.linear().domain([0,1]).range(i);var h=[f(d[0]),f(d[1])];var j=b.scale.linear().domain(i).range(h);var c=this.scale.copy().domain(g.map(j)).range(e.range());return $super(c)},_drawGrid:function($super,c){if(this.grid){$super(c)}}});a.namespace("Rickshaw.Graph.Behavior.Series.Highlight");a.Graph.Behavior.Series.Highlight=function(d){this.graph=d.graph;this.legend=d.legend;var c=this;var g={};var f=null;var e=d.disabledColor||function(h){return b.interpolateRgb(h,b.rgb("#d8d8d8"))(0.8).toString()};this.addHighlightEvents=function(h){h.element.addEventListener("mouseover",function(i){if(f){return}else{f=h}c.legend.lines.forEach(function(j){if(h===j){if(c.graph.renderer.unstack&&(j.series.renderer?j.series.renderer.unstack:true)){var k=c.graph.series.indexOf(j.series);j.originalIndex=k;var l=c.graph.series.splice(k,1)[0];c.graph.series.push(l)}return}g[j.series.name]=g[j.series.name]||j.series.color;j.series.color=e(j.series.color)});c.graph.update()},false);h.element.addEventListener("mouseout",function(i){if(!f){return}else{f=null}c.legend.lines.forEach(function(j){if(h===j&&j.hasOwnProperty("originalIndex")){var k=c.graph.series.pop();c.graph.series.splice(j.originalIndex,0,k);delete j.originalIndex}if(g[j.series.name]){j.series.color=g[j.series.name]}});c.graph.update()},false)};if(this.legend){this.legend.lines.forEach(function(h){c.addHighlightEvents(h)})}};a.namespace("Rickshaw.Graph.Behavior.Series.Order");a.Graph.Behavior.Series.Order=function(d){this.graph=d.graph;this.legend=d.legend;var c=this;if(typeof window.jQuery=="undefined"){throw"couldn't find jQuery at window.jQuery"}if(typeof window.jQuery.ui=="undefined"){throw"couldn't find jQuery UI at window.jQuery.ui"}jQuery(function(){jQuery(c.legend.list).sortable({containment:"parent",tolerance:"pointer",update:function(g,h){var f=[];jQuery(c.legend.list).find("li").each(function(i,j){if(!j.series){return}f.push(j.series)});for(var e=c.graph.series.length-1;e>=0;e--){c.graph.series[e]=f.shift()}c.graph.update()}});jQuery(c.legend.list).disableSelection()});this.graph.onUpdate(function(){var e=window.getComputedStyle(c.legend.element).height;c.legend.element.style.height=e})};a.namespace("Rickshaw.Graph.Behavior.Series.Toggle");a.Graph.Behavior.Series.Toggle=function(d){this.graph=d.graph;this.legend=d.legend;var c=this;this.addAnchor=function(f){var h=document.createElement("a");h.innerHTML="&#10004;";h.classList.add("action");f.element.insertBefore(h,f.element.firstChild);h.onclick=function(i){if(f.series.disabled){f.series.enable();f.element.classList.remove("disabled")}else{if(this.graph.series.filter(function(j){return !j.disabled}).length<=1){return}f.series.disable();f.element.classList.add("disabled")}}.bind(this);var g=f.element.getElementsByTagName("span")[0];g.onclick=function(n){var m=f.series.disabled;if(!m){for(var k=0;k<c.legend.lines.length;k++){var j=c.legend.lines[k];if(f.series===j.series){}else{if(j.series.disabled){}else{m=true;break}}}}if(m){f.series.enable();f.element.classList.remove("disabled");c.legend.lines.forEach(function(i){if(f.series===i.series){}else{i.series.disable();i.element.classList.add("disabled")}})}else{c.legend.lines.forEach(function(i){i.series.enable();i.element.classList.remove("disabled")})}}};if(this.legend){var e=jQuery;if(typeof e!="undefined"&&e(this.legend.list).sortable){e(this.legend.list).sortable({start:function(f,g){g.item.bind("no.onclick",function(h){h.preventDefault()})},stop:function(f,g){setTimeout(function(){g.item.unbind("no.onclick")},250)}})}this.legend.lines.forEach(function(f){c.addAnchor(f)})}this._addBehavior=function(){this.graph.series.forEach(function(f){f.disable=function(){if(c.graph.series.length<=1){throw"only one series left"}f.disabled=true;c.graph.update()};f.enable=function(){f.disabled=false;c.graph.update()}})};this._addBehavior();this.updateBehaviour=function(){this._addBehavior()}};a.namespace("Rickshaw.Graph.HoverDetail");a.Graph.HoverDetail=a.Class.create({initialize:function(c){var e=this.graph=c.graph;this.xFormatter=c.xFormatter||function(f){return new Date(f*1000).toUTCString()};this.yFormatter=c.yFormatter||function(f){return f===null?f:f.toFixed(2)};var d=this.element=document.createElement("div");d.className="detail";this.visible=true;e.element.appendChild(d);this.lastEvent=null;this._addListeners();this.onShow=c.onShow;this.onHide=c.onHide;this.onRender=c.onRender;this.formatter=c.formatter||this.formatter},formatter:function(g,c,i,f,e,h){return g.name+":&nbsp;"+e},update:function(i){i=i||this.lastEvent;if(!i){return}this.lastEvent=i;if(!i.target.nodeName.match(/^(path|svg|rect|circle)$/)){return}var m=this.graph;var d=i.offsetX||i.layerX;var c=i.offsetY||i.layerY;var g=0;var l=[];var k;this.graph.series.active().forEach(function(p){var o=this.graph.stackedData[g++];if(!o.length){return}var j=m.x.invert(d);var r=b.scale.linear().domain([o[0].x,o.slice(-1)[0].x]).range([0,o.length-1]);var w=Math.round(r(j));if(w==o.length-1){w--}var t=Math.min(w||0,o.length-1);for(var q=w;q<o.length-1;){if(!o[q]||!o[q+1]){break}if(o[q].x<=j&&o[q+1].x>j){t=Math.abs(j-o[q].x)<Math.abs(j-o[q+1].x)?q:q+1;break}if(o[q+1].x<=j){q++}else{q--}}if(t<0){t=0}var v=o[t];var e=Math.sqrt(Math.pow(Math.abs(m.x(v.x)-d),2)+Math.pow(Math.abs(m.y(v.y+v.y0)-c),2));var n=p.xFormatter||this.xFormatter;var s=p.yFormatter||this.yFormatter;var u={formattedXValue:n(v.x),formattedYValue:s(p.scale?p.scale.invert(v.y):v.y),series:p,value:v,distance:e,order:g,name:p.name};if(!k||e<k.distance){k=u}l.push(u)},this);if(!k){return}k.active=true;var f=k.value.x;var h=k.formattedXValue;this.element.innerHTML="";this.element.style.left=m.x(f)+"px";this.visible&&this.render({points:l,detail:l,mouseX:d,mouseY:c,formattedXValue:h,domainX:f})},hide:function(){this.visible=false;this.element.classList.add("inactive");if(typeof this.onHide=="function"){this.onHide()}},show:function(){this.visible=true;this.element.classList.remove("inactive");if(typeof this.onShow=="function"){this.onShow()}},render:function(j){var o=this.graph;var n=j.points;var l=n.filter(function(q){return q.active}).shift();if(l.value.y===null){return}var i=l.formattedXValue;var m=l.formattedYValue;this.element.innerHTML="";this.element.style.left=o.x(l.value.x)+"px";var g=document.createElement("div");g.className="x_label";g.innerHTML=i;this.element.appendChild(g);var p=document.createElement("div");p.className="item";var h=l.series;var c=h.scale?h.scale.invert(l.value.y):l.value.y;p.innerHTML=this.formatter(h,l.value.x,c,i,m,l);p.style.top=this.graph.y(l.value.y0+l.value.y)+"px";this.element.appendChild(p);var d=document.createElement("div");d.className="dot";d.style.top=p.style.top;d.style.borderColor=h.color;this.element.appendChild(d);if(l.active){p.classList.add("active");d.classList.add("active")}var k=[g,p];k.forEach(function(q){q.classList.add("left")});this.show();var e=this._calcLayoutError(k);if(e>0){k.forEach(function(q){q.classList.remove("left");q.classList.add("right")});var f=this._calcLayoutError(k);if(f>e){k.forEach(function(q){q.classList.remove("right");q.classList.add("left")})}}if(typeof this.onRender=="function"){this.onRender(j)}},_calcLayoutError:function(e){var c=this.element.parentNode.getBoundingClientRect();var d=0;var f=e.forEach(function(g){var h=g.getBoundingClientRect();if(!h.width){return}if(h.right>c.right){d+=h.right-c.right}if(h.left<c.left){d+=c.left-h.left}});return d},_addListeners:function(){this.graph.element.addEventListener("mousemove",function(c){this.visible=true;this.update(c)}.bind(this),false);this.graph.onUpdate(function(){this.update()}.bind(this));this.graph.element.addEventListener("mouseout",function(c){if(c.relatedTarget&&!(c.relatedTarget.compareDocumentPosition(this.graph.element)&Node.DOCUMENT_POSITION_CONTAINS)){this.hide()}}.bind(this),false)}});a.namespace("Rickshaw.Graph.JSONP");a.Graph.JSONP=a.Class.create(a.Graph.Ajax,{request:function(){jQuery.ajax({url:this.dataURL,dataType:"jsonp",success:this.success.bind(this),error:this.error.bind(this)})}});a.namespace("Rickshaw.Graph.Legend");a.Graph.Legend=a.Class.create({className:"rickshaw_legend",initialize:function(c){this.element=c.element;this.graph=c.graph;this.naturalOrder=c.naturalOrder;this.element.classList.add(this.className);this.list=document.createElement("ul");this.element.appendChild(this.list);this.render();this.graph.onUpdate(function(){})},render:function(){var c=this;while(this.list.firstChild){this.list.removeChild(this.list.firstChild)}this.lines=[];var d=this.graph.series.map(function(e){return e});if(!this.naturalOrder){d=d.reverse()}d.forEach(function(e){c.addLine(e)})},addLine:function(e){var c=document.createElement("li");c.className="line";if(e.disabled){c.className+=" disabled"}if(e.className){b.select(c).classed(e.className,true)}var f=document.createElement("div");f.className="swatch";f.style.backgroundColor=e.color;c.appendChild(f);var d=document.createElement("span");d.className="label";d.innerHTML=e.name;c.appendChild(d);this.list.appendChild(c);c.series=e;if(e.noLegend){c.style.display="none"}var g={element:c,series:e};if(this.shelving){this.shelving.addAnchor(g);this.shelving.updateBehaviour()}if(this.highlighter){this.highlighter.addHighlightEvents(g)}this.lines.push(g);return c}});a.namespace("Rickshaw.Graph.RangeSlider");a.Graph.RangeSlider=a.Class.create({initialize:function(c){var d=this.element=c.element;var e=this.graph=c.graph;this.slideCallbacks=[];this.build();e.onUpdate(function(){this.update()}.bind(this))},build:function(){var d=this.element;var g=this.graph;var f=jQuery;var e=g.dataDomain();var c=this;f(function(){f(d).slider({range:true,min:e[0],max:e[1],values:[e[0],e[1]],slide:function(h,j){if(j.values[1]<=j.values[0]){return}g.window.xMin=j.values[0];g.window.xMax=j.values[1];g.update();var i=g.dataDomain();if(i[0]==j.values[0]){g.window.xMin=undefined}if(i[1]==j.values[1]){g.window.xMax=undefined}c.slideCallbacks.forEach(function(k){k(g,g.window.xMin,g.window.xMax)})}})});f(d)[0].style.width=g.width+"px"},update:function(){var d=this.element;var g=this.graph;var f=jQuery;var c=f(d).slider("option","values");var e=g.dataDomain();f(d).slider("option","min",e[0]);f(d).slider("option","max",e[1]);if(g.window.xMin==null){c[0]=e[0]}if(g.window.xMax==null){c[1]=e[1]}f(d).slider("option","values",c)},onSlide:function(c){this.slideCallbacks.push(c)}});a.namespace("Rickshaw.Graph.RangeSlider.Preview");a.Graph.RangeSlider.Preview=a.Class.create({initialize:function(c){if(!c.element){throw"Rickshaw.Graph.RangeSlider.Preview needs a reference to an element"}if(!c.graph&&!c.graphs){throw"Rickshaw.Graph.RangeSlider.Preview needs a reference to an graph or an array of graphs"}this.element=c.element;this.element.style.position="relative";this.graphs=c.graph?[c.graph]:c.graphs;this.defaults={height:75,width:400,gripperColor:undefined,frameTopThickness:3,frameHandleThickness:10,frameColor:"#d4d4d4",frameOpacity:1,minimumFrameWidth:0,heightRatio:0.2};this.heightRatio=c.heightRatio||this.defaults.heightRatio;this.defaults.gripperColor=b.rgb(this.defaults.frameColor).darker().toString();this.configureCallbacks=[];this.slideCallbacks=[];this.previews=[];if(!c.width){this.widthFromGraph=true}if(!c.height){this.heightFromGraph=true}if(this.widthFromGraph||this.heightFromGraph){this.graphs[0].onConfigure(function(){this.configure(c);this.render()}.bind(this))}c.width=c.width||this.graphs[0].width||this.defaults.width;c.height=c.height||this.graphs[0].height*this.heightRatio||this.defaults.height;this.configure(c);this.render()},onSlide:function(c){this.slideCallbacks.push(c)},onConfigure:function(c){this.configureCallbacks.push(c)},configure:function(c){this.config=this.config||{};this.configureCallbacks.forEach(function(d){d(c)});a.keys(this.defaults).forEach(function(d){this.config[d]=d in c?c[d]:d in this.config?this.config[d]:this.defaults[d]},this);if("width" in c||"height" in c){if(this.widthFromGraph){this.config.width=this.graphs[0].width}if(this.heightFromGraph){this.config.height=this.graphs[0].height*this.heightRatio;this.previewHeight=this.config.height}this.previews.forEach(function(h){var d=this.previewHeight/this.graphs.length-this.config.frameTopThickness*2;var g=this.config.width-this.config.frameHandleThickness*2;h.setSize({width:g,height:d});if(this.svg){var e=d+this.config.frameHandleThickness*2;var f=g+this.config.frameHandleThickness*2;this.svg.style("width",f+"px");this.svg.style("height",e+"px")}},this)}},render:function(){var f=this;this.svg=b.select(this.element).selectAll("svg.rickshaw_range_slider_preview").data([null]);this.previewHeight=this.config.height-this.config.frameTopThickness*2;this.previewWidth=this.config.width-this.config.frameHandleThickness*2;this.currentFrame=[0,this.previewWidth];var h=function(m,k){var l=a.extend({},m.config);var j=f.previewHeight/f.graphs.length;var o=m.renderer.name;a.extend(l,{element:this.appendChild(document.createElement("div")),height:j,width:f.previewWidth,series:m.series,renderer:o});var n=new a.Graph(l);f.previews.push(n);m.onUpdate(function(){n.render();f.render()});m.onConfigure(function(p){delete p.height;p.width=p.width-f.config.frameHandleThickness*2;n.configure(p);n.render()});n.render()};var g=b.select(this.element).selectAll("div.rickshaw_range_slider_preview_container").data(this.graphs);var e="translate("+this.config.frameHandleThickness+"px, "+this.config.frameTopThickness+"px)";g.enter().append("div").classed("rickshaw_range_slider_preview_container",true).style("-webkit-transform",e).style("-moz-transform",e).style("-ms-transform",e).style("transform",e).each(h);g.exit().remove();var d=this.graphs[0];var c=b.scale.linear().domain([0,this.previewWidth]).range(d.dataDomain());var i=[d.window.xMin,d.window.xMax];this.currentFrame[0]=i[0]===undefined?0:Math.round(c.invert(i[0]));if(this.currentFrame[0]<0){this.currentFrame[0]=0}this.currentFrame[1]=i[1]===undefined?this.previewWidth:c.invert(i[1]);if(this.currentFrame[1]-this.currentFrame[0]<f.config.minimumFrameWidth){this.currentFrame[1]=(this.currentFrame[0]||0)+f.config.minimumFrameWidth}this.svg.enter().append("svg").classed("rickshaw_range_slider_preview",true).style("height",this.config.height+"px").style("width",this.config.width+"px").style("position","absolute").style("top",0);this._renderDimming();this._renderFrame();this._renderGrippers();this._renderHandles();this._renderMiddle();this._registerMouseEvents()},_renderDimming:function(){var c=this.svg.selectAll("path.dimming").data([null]);c.enter().append("path").attr("fill","white").attr("fill-opacity","0.7").attr("fill-rule","evenodd").classed("dimming",true);var d="";d+=" M "+this.config.frameHandleThickness+" "+this.config.frameTopThickness;d+=" h "+this.previewWidth;d+=" v "+this.previewHeight;d+=" h "+-this.previewWidth;d+=" z ";d+=" M "+Math.max(this.currentFrame[0],this.config.frameHandleThickness)+" "+this.config.frameTopThickness;d+=" H "+Math.min(this.currentFrame[1]+this.config.frameHandleThickness*2,this.previewWidth+this.config.frameHandleThickness);d+=" v "+this.previewHeight;d+=" H "+Math.max(this.currentFrame[0],this.config.frameHandleThickness);d+=" z";c.attr("d",d)},_renderFrame:function(){var c=this.svg.selectAll("path.frame").data([null]);c.enter().append("path").attr("stroke","white").attr("stroke-width","1px").attr("stroke-linejoin","round").attr("fill",this.config.frameColor).attr("fill-opacity",this.config.frameOpacity).attr("fill-rule","evenodd").classed("frame",true);var d="";d+=" M "+this.currentFrame[0]+" 0";d+=" H "+(this.currentFrame[1]+this.config.frameHandleThickness*2);d+=" V "+this.config.height;d+=" H "+this.currentFrame[0];d+=" z";d+=" M "+(this.currentFrame[0]+this.config.frameHandleThickness)+" "+this.config.frameTopThickness;d+=" H "+(this.currentFrame[1]+this.config.frameHandleThickness);d+=" v "+this.previewHeight;d+=" H "+(this.currentFrame[0]+this.config.frameHandleThickness);d+=" z";c.attr("d",d)},_renderGrippers:function(){var c=this.svg.selectAll("path.gripper").data([null]);c.enter().append("path").attr("stroke",this.config.gripperColor).classed("gripper",true);var d="";[0.4,0.6].forEach(function(e){d+=" M "+Math.round(this.currentFrame[0]+this.config.frameHandleThickness*e)+" "+Math.round(this.config.height*0.3);d+=" V "+Math.round(this.config.height*0.7);d+=" M "+Math.round(this.currentFrame[1]+this.config.frameHandleThickness*(1+e))+" "+Math.round(this.config.height*0.3);d+=" V "+Math.round(this.config.height*0.7)}.bind(this));c.attr("d",d)},_renderHandles:function(){var c=this.svg.selectAll("rect.left_handle").data([null]);c.enter().append("rect").attr("width",this.config.frameHandleThickness).style("cursor","ew-resize").style("fill-opacity","0").classed("left_handle",true);c.attr("x",this.currentFrame[0]).attr("height",this.config.height);var d=this.svg.selectAll("rect.right_handle").data([null]);d.enter().append("rect").attr("width",this.config.frameHandleThickness).style("cursor","ew-resize").style("fill-opacity","0").classed("right_handle",true);d.attr("x",this.currentFrame[1]+this.config.frameHandleThickness).attr("height",this.config.height)},_renderMiddle:function(){var c=this.svg.selectAll("rect.middle_handle").data([null]);c.enter().append("rect").style("cursor","move").style("fill-opacity","0").classed("middle_handle",true);c.attr("width",Math.max(0,this.currentFrame[1]-this.currentFrame[0])).attr("x",this.currentFrame[0]+this.config.frameHandleThickness).attr("height",this.config.height)},_registerMouseEvents:function(){var f=b.select(this.element);var i={target:null,start:null,stop:null,left:false,right:false,rigid:false};var k=this;function j(l,m){i.stop=k._getClientXFromEvent(b.event,i);var p=i.stop-i.start;var q=k.frameBeforeDrag.slice(0);var o=k.config.minimumFrameWidth;if(i.rigid){o=k.frameBeforeDrag[1]-k.frameBeforeDrag[0]}if(i.left){q[0]=Math.max(q[0]+p,0)}if(i.right){q[1]=Math.min(q[1]+p,k.previewWidth)}var n=q[1]-q[0];if(n<=o){if(i.left){q[0]=q[1]-o}if(i.right){q[1]=q[0]+o}if(q[0]<=0){q[1]-=q[0];q[0]=0}if(q[1]>=k.previewWidth){q[0]-=q[1]-k.previewWidth;q[1]=k.previewWidth}}k.graphs.forEach(function(t){var r=b.scale.linear().interpolate(b.interpolateNumber).domain([0,k.previewWidth]).range(t.dataDomain());var s=[r(q[0]),r(q[1])];k.slideCallbacks.forEach(function(u){u(t,s[0],s[1])});if(q[0]===0){s[0]=undefined}if(q[1]===k.previewWidth){s[1]=undefined}t.window.xMin=s[0];t.window.xMax=s[1];t.update()})}function g(){i.target=b.event.target;i.start=k._getClientXFromEvent(b.event,i);k.frameBeforeDrag=k.currentFrame.slice();b.event.preventDefault?b.event.preventDefault():b.event.returnValue=false;b.select(document).on("mousemove.rickshaw_range_slider_preview",j);b.select(document).on("mouseup.rickshaw_range_slider_preview",e);b.select(document).on("touchmove.rickshaw_range_slider_preview",j);b.select(document).on("touchend.rickshaw_range_slider_preview",e);b.select(document).on("touchcancel.rickshaw_range_slider_preview",e)}function d(l,m){i.left=true;g()}function h(l,m){i.right=true;g()}function c(l,m){i.left=true;i.right=true;i.rigid=true;g()}function e(l,m){b.select(document).on("mousemove.rickshaw_range_slider_preview",null);b.select(document).on("mouseup.rickshaw_range_slider_preview",null);b.select(document).on("touchmove.rickshaw_range_slider_preview",null);b.select(document).on("touchend.rickshaw_range_slider_preview",null);b.select(document).on("touchcancel.rickshaw_range_slider_preview",null);delete k.frameBeforeDrag;i.left=false;i.right=false;i.rigid=false}f.select("rect.left_handle").on("mousedown",d);f.select("rect.right_handle").on("mousedown",h);f.select("rect.middle_handle").on("mousedown",c);f.select("rect.left_handle").on("touchstart",d);f.select("rect.right_handle").on("touchstart",h);f.select("rect.middle_handle").on("touchstart",c)},_getClientXFromEvent:function(e,d){switch(e.type){case"touchstart":case"touchmove":var c=e.changedTouches;var g=null;for(var f=0;f<c.length;f++){if(c[f].target===d.target){g=c[f];break}}return g!==null?g.clientX:undefined;default:return e.clientX}}});a.namespace("Rickshaw.Graph.Renderer");a.Graph.Renderer=a.Class.create({initialize:function(c){this.graph=c.graph;this.tension=c.tension||this.tension;this.configure(c)},seriesPathFactory:function(){},seriesStrokeFactory:function(){},defaults:function(){return{tension:0.8,strokeWidth:2,unstack:true,padding:{top:0.01,right:0,bottom:0.01,left:0},stroke:false,fill:false}},domain:function(g){var e=g||this.graph.stackedData||this.graph.stackData();var d=+Infinity;var h=-Infinity;var c=+Infinity;var f=-Infinity;e.forEach(function(i){i.forEach(function(j){if(j.y==null){return}var k=j.y+j.y0;if(k<c){c=k}if(k>f){f=k}});if(!i.length){return}if(i[0].x<d){d=i[0].x}if(i[i.length-1].x>h){h=i[i.length-1].x}});d-=(h-d)*this.padding.left;h+=(h-d)*this.padding.right;c=this.graph.min==="auto"?c:this.graph.min||0;f=this.graph.max===undefined?f:this.graph.max;if(this.graph.min==="auto"||c<0){c-=(f-c)*this.padding.bottom}if(this.graph.max===undefined){f+=(f-c)*this.padding.top}return{x:[d,h],y:[c,f]}},render:function(c){c=c||{};var j=this.graph;var e=c.series||j.series;var h=c.vis||j.vis;h.selectAll("*").remove();var g=e.filter(function(i){return !i.disabled}).map(function(i){return i.stack});var k=h.selectAll("path.path").data(g).enter().append("svg:path").classed("path",true).attr("d",this.seriesPathFactory());if(this.stroke){var f=h.selectAll("path.stroke").data(g).enter().append("svg:path").classed("stroke",true).attr("d",this.seriesStrokeFactory())}var d=0;e.forEach(function(i){if(i.disabled){return}i.path=k[0][d];if(this.stroke){i.stroke=f[0][d]}this._styleSeries(i);d++},this)},_styleSeries:function(c){var e=this.fill?c.color:"none";var d=this.stroke?c.color:"none";c.path.setAttribute("fill",e);c.path.setAttribute("stroke",d);c.path.setAttribute("stroke-width",this.strokeWidth);if(c.className){b.select(c.path).classed(c.className,true)}if(c.className&&this.stroke){b.select(c.stroke).classed(c.className,true)}},configure:function(c){c=c||{};a.keys(this.defaults()).forEach(function(d){if(!c.hasOwnProperty(d)){this[d]=this[d]||this.graph[d]||this.defaults()[d];return}if(typeof this.defaults()[d]=="object"){a.keys(this.defaults()[d]).forEach(function(e){this[d][e]=c[d][e]!==undefined?c[d][e]:this[d][e]!==undefined?this[d][e]:this.defaults()[d][e]},this)}else{this[d]=c[d]!==undefined?c[d]:this[d]!==undefined?this[d]:this.graph[d]!==undefined?this.graph[d]:this.defaults()[d]}},this)},setStrokeWidth:function(c){if(c!==undefined){this.strokeWidth=c}},setTension:function(c){if(c!==undefined){this.tension=c}}});a.namespace("Rickshaw.Graph.Renderer.Line");a.Graph.Renderer.Line=a.Class.create(a.Graph.Renderer,{name:"line",defaults:function($super){return a.extend($super(),{unstack:true,fill:false,stroke:true})},seriesPathFactory:function(){var d=this.graph;var c=b.svg.line().x(function(e){return d.x(e.x)}).y(function(e){return d.y(e.y)}).interpolate(this.graph.interpolation).tension(this.tension);c.defined&&c.defined(function(e){return e.y!==null});return c}});a.namespace("Rickshaw.Graph.Renderer.Stack");a.Graph.Renderer.Stack=a.Class.create(a.Graph.Renderer,{name:"stack",defaults:function($super){return a.extend($super(),{fill:true,stroke:false,unstack:false})},seriesPathFactory:function(){var d=this.graph;var c=b.svg.area().x(function(e){return d.x(e.x)}).y0(function(e){return d.y(e.y0)}).y1(function(e){return d.y(e.y+e.y0)}).interpolate(this.graph.interpolation).tension(this.tension);c.defined&&c.defined(function(e){return e.y!==null});return c}});a.namespace("Rickshaw.Graph.Renderer.Bar");a.Graph.Renderer.Bar=a.Class.create(a.Graph.Renderer,{name:"bar",defaults:function($super){var c=a.extend($super(),{gapSize:0.05,unstack:false});delete c.tension;return c},initialize:function($super,c){c=c||{};this.gapSize=c.gapSize||this.gapSize;$super(c)},domain:function($super){var d=$super();var c=this._frequentInterval(this.graph.stackedData.slice(-1).shift());d.x[1]+=Number(c.magnitude);return d},barWidth:function(d){var c=this._frequentInterval(d.stack);var e=this.graph.x.magnitude(c.magnitude)*(1-this.gapSize);return e},render:function(i){i=i||{};var j=this.graph;var h=i.series||j.series;var f=i.vis||j.vis;f.selectAll("*").remove();var k=this.barWidth(h.active()[0]);var e=0;var c=h.filter(function(l){return !l.disabled}).length;var d=this.unstack?k/c:k;var g=function(m){var l=[1,0,0,m.y<0?-1:1,0,m.y<0?j.y.magnitude(Math.abs(m.y))*2:0];return"matrix("+l.join(",")+")"};h.forEach(function(m){if(m.disabled){return}var n=this.barWidth(m);var l=f.selectAll("path").data(m.stack.filter(function(o){return o.y!==null})).enter().append("svg:rect").attr("x",function(o){return j.x(o.x)+e}).attr("y",function(o){return j.y(o.y0+Math.abs(o.y))*(o.y<0?-1:1)}).attr("width",d).attr("height",function(o){return j.y.magnitude(Math.abs(o.y))}).attr("transform",g);Array.prototype.forEach.call(l[0],function(o){o.setAttribute("fill",m.color)});if(this.unstack){e+=d}},this)},_frequentInterval:function(g){var f={};for(var e=0;e<g.length-1;e++){var c=g[e+1].x-g[e].x;f[c]=f[c]||0;f[c]++}var d={count:0,magnitude:1};a.keys(f).forEach(function(h){if(d.count<f[h]){d={count:f[h],magnitude:h}}});return d}});a.namespace("Rickshaw.Graph.Renderer.Area");a.Graph.Renderer.Area=a.Class.create(a.Graph.Renderer,{name:"area",defaults:function($super){return a.extend($super(),{unstack:false,fill:false,stroke:false})},seriesPathFactory:function(){var d=this.graph;var c=b.svg.area().x(function(e){return d.x(e.x)}).y0(function(e){return d.y(e.y0)}).y1(function(e){return d.y(e.y+e.y0)}).interpolate(d.interpolation).tension(this.tension);c.defined&&c.defined(function(e){return e.y!==null});return c},seriesStrokeFactory:function(){var d=this.graph;var c=b.svg.line().x(function(e){return d.x(e.x)}).y(function(e){return d.y(e.y+e.y0)}).interpolate(d.interpolation).tension(this.tension);c.defined&&c.defined(function(e){return e.y!==null});return c},render:function(d){d=d||{};var j=this.graph;var f=d.series||j.series;var h=d.vis||j.vis;h.selectAll("*").remove();var k=this.unstack?"append":"insert";var g=f.filter(function(i){return !i.disabled}).map(function(i){return i.stack});var c=h.selectAll("path").data(g).enter()[k]("svg:g","g");c.append("svg:path").attr("d",this.seriesPathFactory()).attr("class","area");if(this.stroke){c.append("svg:path").attr("d",this.seriesStrokeFactory()).attr("class","line")}var e=0;f.forEach(function(i){if(i.disabled){return}i.path=c[0][e++];this._styleSeries(i)},this)},_styleSeries:function(c){if(!c.path){return}b.select(c.path).select(".area").attr("fill",c.color);if(this.stroke){b.select(c.path).select(".line").attr("fill","none").attr("stroke",c.stroke||b.interpolateRgb(c.color,"black")(0.125)).attr("stroke-width",this.strokeWidth)}if(c.className){c.path.setAttribute("class",c.className)}}});a.namespace("Rickshaw.Graph.Renderer.ScatterPlot");a.Graph.Renderer.ScatterPlot=a.Class.create(a.Graph.Renderer,{name:"scatterplot",defaults:function($super){return a.extend($super(),{unstack:true,fill:true,stroke:false,padding:{top:0.01,right:0.01,bottom:0.01,left:0.01},dotSize:4})},initialize:function($super,c){$super(c)},render:function(d){d=d||{};var g=this.graph;var e=d.series||g.series;var f=d.vis||g.vis;var c=this.dotSize;f.selectAll("*").remove();e.forEach(function(i){if(i.disabled){return}var h=f.selectAll("path").data(i.stack.filter(function(j){return j.y!==null})).enter().append("svg:circle").attr("cx",function(j){return g.x(j.x)}).attr("cy",function(j){return g.y(j.y)}).attr("r",function(j){return"r" in j?j.r:c});if(i.className){h.classed(i.className,true)}Array.prototype.forEach.call(h[0],function(j){j.setAttribute("fill",i.color)})},this)}});a.namespace("Rickshaw.Graph.Renderer.Multi");a.Graph.Renderer.Multi=a.Class.create(a.Graph.Renderer,{name:"multi",initialize:function($super,c){$super(c)},defaults:function($super){return a.extend($super(),{unstack:true,fill:false,stroke:true})},configure:function($super,c){c=c||{};this.config=c;$super(c)},domain:function($super){this.graph.stackData();var e=[];var d=this._groups();this._stack(d);d.forEach(function(k){var j=k.series.filter(function(l){return !l.disabled}).map(function(l){return l.stack});if(!j.length){return}var i=null;if(k.renderer&&k.renderer.domain){i=k.renderer.domain(j)}else{i=$super(j)}e.push(i)});var f=b.min(e.map(function(i){return i.x[0]}));var h=b.max(e.map(function(i){return i.x[1]}));var c=b.min(e.map(function(i){return i.y[0]}));var g=b.max(e.map(function(i){return i.y[1]}));return{x:[f,h],y:[c,g]}},_groups:function(){var d=this.graph;var e={};d.series.forEach(function(g){if(g.disabled){return}if(!e[g.renderer]){var h="http://www.w3.org/2000/svg";var j=document.createElementNS(h,"g");d.vis[0][0].appendChild(j);var i=d._renderers[g.renderer];var f={};var k=[this.defaults(),i.defaults(),this.config,this.graph];k.forEach(function(l){a.extend(f,l)});i.configure(f);e[g.renderer]={renderer:i,series:[],vis:b.select(j)}}e[g.renderer].series.push(g)},this);var c=[];Object.keys(e).forEach(function(f){var g=e[f];c.push(g)});return c},_stack:function(c){c.forEach(function(h){var e=h.series.filter(function(i){return !i.disabled});var g=e.map(function(i){return i.stack});if(!h.renderer.unstack){var f=b.layout.stack();var d=a.clone(f(g));e.forEach(function(j,i){j._stack=a.clone(d[i])})}},this);return c},render:function(){this.graph.series.forEach(function(d){if(!d.renderer){throw new Error("Each series needs a renderer for graph 'multi' renderer")}});this.graph.vis.selectAll("*").remove();var c=this._groups();c=this._stack(c);c.forEach(function(e){var d=e.series.filter(function(f){return !f.disabled});d.active=function(){return d};e.renderer.render({series:d,vis:e.vis});d.forEach(function(f){f.stack=f._stack||f.stack||f.data})})}});a.namespace("Rickshaw.Graph.Renderer.LinePlot");a.Graph.Renderer.LinePlot=a.Class.create(a.Graph.Renderer,{name:"lineplot",defaults:function($super){return a.extend($super(),{unstack:true,fill:false,stroke:true,padding:{top:0.01,right:0.01,bottom:0.01,left:0.01},dotSize:3,strokeWidth:2})},seriesPathFactory:function(){var d=this.graph;var c=b.svg.line().x(function(e){return d.x(e.x)}).y(function(e){return d.y(e.y)}).interpolate(this.graph.interpolation).tension(this.tension);c.defined&&c.defined(function(e){return e.y!==null});return c},render:function(e){e=e||{};var k=this.graph;var g=e.series||k.series;var j=e.vis||k.vis;var c=this.dotSize;j.selectAll("*").remove();var h=g.filter(function(i){return !i.disabled}).map(function(i){return i.stack});var d=j.selectAll("path").data(h).enter().append("svg:path").attr("d",this.seriesPathFactory());var f=0;g.forEach(function(i){if(i.disabled){return}i.path=d[0][f++];this._styleSeries(i)},this);g.forEach(function(l){if(l.disabled){return}var i=j.selectAll("x").data(l.stack.filter(function(m){return m.y!==null})).enter().append("svg:circle").attr("cx",function(m){return k.x(m.x)}).attr("cy",function(m){return k.y(m.y)}).attr("r",function(m){return"r" in m?m.r:c});Array.prototype.forEach.call(i[0],function(m){if(!m){return}m.setAttribute("data-color",l.color);m.setAttribute("fill","white");m.setAttribute("stroke",l.color);m.setAttribute("stroke-width",this.strokeWidth)}.bind(this))},this)}});a.namespace("Rickshaw.Graph.Smoother");a.Graph.Smoother=a.Class.create({initialize:function(c){this.graph=c.graph;this.element=c.element;this.aggregationScale=1;this.build();this.graph.stackData.hooks.data.push({name:"smoother",orderPosition:50,f:this.transformer.bind(this)})},build:function(){var c=this;var d=jQuery;if(this.element){d(function(){d(c.element).slider({min:1,max:100,slide:function(e,f){c.setScale(f.value);c.graph.update()}})})}},setScale:function(c){if(c<1){throw"scale out of range: "+c}this.aggregationScale=c;this.graph.update()},transformer:function(d){if(this.aggregationScale==1){return d}var c=[];d.forEach(function(h){var e=[];while(h.length){var g=0,f=0;var i=h.splice(0,this.aggregationScale);i.forEach(function(j){g+=j.x/i.length;f+=j.y/i.length});e.push({x:g,y:f})}c.push(e)}.bind(this));return c}});a.namespace("Rickshaw.Graph.Socketio");a.Graph.Socketio=a.Class.create(a.Graph.Ajax,{request:function(){var c=io.connect(this.dataURL);var d=this;c.on("rickshaw",function(e){d.success(e)})}});a.namespace("Rickshaw.Series");a.Series=a.Class.create(Array,{initialize:function(f,c,e){e=e||{};this.palette=new a.Color.Palette(c);this.timeBase=typeof e.timeBase==="undefined"?Math.floor((new Date).getTime()/1000):e.timeBase;var d=typeof e.timeInterval=="undefined"?1000:e.timeInterval;this.setTimeInterval(d);if(f&&typeof f=="object"&&Array.isArray(f)){f.forEach(function(g){this.addItem(g)},this)}},addItem:function(c){if(typeof c.name==="undefined"){throw"addItem() needs a name"}c.color=c.color||this.palette.color(c.name);c.data=c.data||[];if(c.data.length===0&&this.length&&this.getIndex()>0){this[0].data.forEach(function(d){c.data.push({x:d.x,y:0})})}else{if(c.data.length===0){c.data.push({x:this.timeBase-(this.timeInterval||0),y:0})}}this.push(c);if(this.legend){this.legend.addLine(this.itemByName(c.name))}},addData:function(e,c){var d=this.getIndex();a.keys(e).forEach(function(f){if(!this.itemByName(f)){this.addItem({name:f})}},this);this.forEach(function(f){f.data.push({x:c||(d*this.timeInterval||1)+this.timeBase,y:e[f.name]||0})},this)},getIndex:function(){return this[0]&&this[0].data&&this[0].data.length?this[0].data.length:0},itemByName:function(c){for(var d=0;d<this.length;d++){if(this[d].name==c){return this[d]}}},setTimeInterval:function(c){this.timeInterval=c/1000},setTimeBase:function(c){this.timeBase=c},dump:function(){var c={timeBase:this.timeBase,timeInterval:this.timeInterval,items:[]};this.forEach(function(e){var d={color:e.color,name:e.name,data:[]};e.data.forEach(function(f){d.data.push({x:f.x,y:f.y})});c.items.push(d)});return c},load:function(c){if(c.timeInterval){this.timeInterval=c.timeInterval}if(c.timeBase){this.timeBase=c.timeBase}if(c.items){c.items.forEach(function(d){this.push(d);if(this.legend){this.legend.addLine(this.itemByName(d.name))}},this)}}});a.Series.zeroFill=function(c){a.Series.fill(c,0)};a.Series.fill=function(e,g){var c;var d=0;var f=e.map(function(h){return h.data});while(d<Math.max.apply(null,f.map(function(h){return h.length}))){c=Math.min.apply(null,f.filter(function(h){return h[d]}).map(function(h){return h[d].x}));f.forEach(function(h){if(!h[d]||h[d].x!=c){h.splice(d,0,{x:c,y:g})}});d++}};a.namespace("Rickshaw.Series.FixedDuration");a.Series.FixedDuration=a.Class.create(a.Series,{initialize:function(f,c,d){d=d||{};if(typeof d.timeInterval==="undefined"){throw new Error("FixedDuration series requires timeInterval")}if(typeof d.maxDataPoints==="undefined"){throw new Error("FixedDuration series requires maxDataPoints")}this.palette=new a.Color.Palette(c);this.timeBase=typeof d.timeBase==="undefined"?Math.floor((new Date).getTime()/1000):d.timeBase;this.setTimeInterval(d.timeInterval);if(this[0]&&this[0].data&&this[0].data.length){this.currentSize=this[0].data.length;this.currentIndex=this[0].data.length}else{this.currentSize=0;this.currentIndex=0}this.maxDataPoints=d.maxDataPoints;if(f&&typeof f=="object"&&Array.isArray(f)){f.forEach(function(g){this.addItem(g)},this);this.currentSize+=1;this.currentIndex+=1}this.timeBase-=(this.maxDataPoints-this.currentSize)*this.timeInterval;if(typeof this.maxDataPoints!=="undefined"&&this.currentSize<this.maxDataPoints){for(var e=this.maxDataPoints-this.currentSize-1;e>1;e--){this.currentSize+=1;this.currentIndex+=1;this.forEach(function(g){g.data.unshift({x:((e-1)*this.timeInterval||1)+this.timeBase,y:0,i:e})},this)}}},addData:function($super,d,c){$super(d,c);this.currentSize+=1;this.currentIndex+=1;if(this.maxDataPoints!==undefined){while(this.currentSize>this.maxDataPoints){this.dropData()}}},dropData:function(){this.forEach(function(c){c.data.splice(0,1)});this.currentSize-=1},getIndex:function(){return this.currentIndex}});return a});